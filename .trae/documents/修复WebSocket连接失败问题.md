# 修复WebSocket连接失败问题

## 问题分析
根据错误日志和代码分析，WebSocket连接失败的主要原因是`mbedtls_ssl_setup returned -0x7F00`，这表示SSL/TLS握手过程中出现了问题。可能的原因包括：

1. **TLS版本不兼容**：服务器可能只支持TLS 1.3，而当前配置仅启用了TLS 1.2
2. **证书验证失败**：服务器证书可能不在ESP32的默认证书捆绑包中
3. **网络配置问题**：DNS解析或网络连接问题
4. **缺少必要的TLS配置**：可能需要特定的密码套件或TLS参数

## 修复方案

### 1. 启用TLS 1.3支持
在`sdkconfig`中启用TLS 1.3支持，因为现代服务器通常优先使用TLS 1.3。

### 2. 增强错误日志
在Protocol组件中添加更详细的错误日志，特别是在WebSocket事件处理函数中，以便更好地诊断问题。

### 3. 添加证书验证调试选项
在开发阶段添加一个选项来禁用证书验证（仅用于调试），以确定是否是证书问题导致的连接失败。

### 4. 检查并优化WebSocket配置
- 确保WebSocket客户端配置正确
- 添加连接超时处理
- 实现重连机制

### 5. 验证网络连接
添加网络连接状态检查，确保设备已正确连接到WiFi并能解析DNS。

## 实施步骤

1. **修改sdkconfig**：启用TLS 1.3支持
2. **修改protocol.c**：增强错误日志和添加调试选项
3. **测试连接**：使用修改后的代码测试连接
4. **根据测试结果调整**：如果问题仍然存在，进一步调整配置

## 预期结果
- WebSocket连接成功建立
- 详细的错误日志有助于诊断任何后续问题
- 实现的重连机制提高了系统的可靠性

## 注意事项
- 禁用证书验证仅用于调试，生产环境必须启用证书验证
- 确保使用最新的证书捆绑包
- 测试不同网络环境下的连接稳定性